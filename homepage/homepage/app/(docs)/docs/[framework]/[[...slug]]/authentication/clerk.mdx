export const metadata = { title: "Clerk Authentication" };

import { CodeGroup, ContentByFramework } from "@/components/forMdx";

# Clerk Authentication

Jazz can be used with [Clerk](https://clerk.com/) to authenticate users. This method isn't fully local-first, as login and signup need to be done online.

## How it works

When using Clerk authentication:
- Clerk and your app admins hold the user's key secret
- Once authenticated, users can use Jazz offline
- Jazz's features work without needing to be online

## Platform support

<ContentByFramework framework="react-native">
We do not currently support Clerk in React Native, but we do in [React Native Expo](/docs/react-native-expo/authentication/clerk).
</ContentByFramework>

## Implementation

<ContentByFramework framework="react">
We offer Clerk integration through our package: [`jazz-react-auth-clerk`](https://npmjs.com/package/jazz-react-auth-clerk).

After installing, use `<JazzProviderWithClerk />` to wrap your app:

<CodeGroup>
```tsx twoslash
import * as React from "react";
import { createRoot } from "react-dom/client";
const apiKey = "you@example.com";
const PUBLISHABLE_KEY = "fake_key";
function App() {
  return <div>Hello World</div>;
}
// ---cut---
import { useClerk, ClerkProvider } from '@clerk/clerk-react';
import { JazzProviderWithClerk } from "jazz-react-auth-clerk";

function JazzProvider({ children }: { children: React.ReactNode }) {
  const clerk = useClerk();

  return (
    <JazzProviderWithClerk
      clerk={clerk}
      sync={{
        peer: `wss://cloud.jazz.tools/?key=${apiKey}`,
      }}
    >
      {children}
    </JazzProviderWithClerk>
  );
}

createRoot(document.getElementById("root")!).render(
  <ClerkProvider publishableKey={PUBLISHABLE_KEY} afterSignOutUrl="/">
    <JazzProvider>
      <App />
    </JazzProvider>
  </ClerkProvider>
);
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework framework="react-native-expo">
<CodeGroup>
```tsx twoslash
import * as React from "react";
import { Slot } from "expo-router";
const apiKey = "you@example.com";
const tokenCache = {
  getToken: async (key: string) => {
    return null;
  },
  saveToken: async (key: string, token: string) => {},
  clearToken: async (key: string) => {},
};
// ---cut---
import { useClerk, ClerkProvider, ClerkLoaded } from '@clerk/clerk-expo';
import { secureStore } from "@clerk/clerk-expo/secure-store";
import { JazzProviderWithClerk } from "jazz-expo/auth/clerk";

function JazzAndAuth({ children }: { children: React.ReactNode }) {
  const clerk = useClerk();

  return (
    <JazzProviderWithClerk
      clerk={clerk}
      sync={{
        peer: `wss://cloud.jazz.tools/?key=${apiKey}`,
      }}
    >
      {children}
    </JazzProviderWithClerk>
  );
}

export default function RootLayout() {
  const publishableKey = process.env.EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY;

  if (!publishableKey) {
    throw new Error(
      "Missing Publishable Key. Please set EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY in your .env",
    );
  }

  return (
    <ClerkProvider
      tokenCache={tokenCache}
      publishableKey={publishableKey}
      __experimental_resourceCache={secureStore}
    >
      <ClerkLoaded>
        <JazzAndAuth>
          <Slot />
        </JazzAndAuth>
      </ClerkLoaded>
    </ClerkProvider>
  );
}
```
</CodeGroup>
</ContentByFramework>

## Using Clerk auth methods

<ContentByFramework framework="react">
Once set up, you can use Clerk's auth methods for login and signup:

<CodeGroup>
```tsx twoslash
import * as React from "react";
// ---cut---
import { SignInButton } from "@clerk/clerk-react";
import { useAccount, useIsAuthenticated } from "jazz-react";

export function AuthButton() {
  const { logOut } = useAccount();

  const isAuthenticated = useIsAuthenticated();

  if (isAuthenticated) {
    return <button onClick={() => logOut()}>Logout</button>;
  }

  return <SignInButton />;
}
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework framework="react-native-expo">
Once set up, you can use Clerk's auth methods for login and signup:

<CodeGroup>
```tsx twoslash
import * as React from "react";
// ---cut---
import { useSignIn } from "@clerk/clerk-expo";
import { useAccount, useIsAuthenticated } from "jazz-expo";
import { Button, Text } from 'react-native';

export function AuthButton() {
  const { logOut } = useAccount();
  const { signIn, setActive, isLoaded } = useSignIn();
  const isAuthenticated = useIsAuthenticated();

  if (isAuthenticated) {
    return <Button title="Logout" onPress={() => logOut()} />;
  }

  const onSignInPress = async () => {
    if (!isLoaded) return;
    const signInAttempt = await signIn.create({
      identifier: "you@example.com",
      password: "password",
    });
    if (signInAttempt.status === "complete") {
      await setActive({ session: signInAttempt.createdSessionId });
    }
  };

  return <Button title="Sign In" onPress={onSignInPress} />;
}
```
</CodeGroup>
</ContentByFramework>

## When to choose Clerk authentication

Clerk authentication is ideal when:

- You need an existing user management system
- You want to integrate with other Clerk features (roles, permissions)
- You require email/password authentication with verification
- You need OAuth providers (Google, GitHub, etc.)
- You want to avoid users having to manage passphrases

## Limitations to consider

- Requires internet connection for signup/login
- Clerk admins have access to user keys
- Not fully local-first (initial auth requires a server)
