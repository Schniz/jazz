export const metadata = { title: "Public sharing and invites" };

import { ContentByFramework, CodeGroup } from '@/components/forMdx'

# Public sharing and invites

...more docs coming soon

## Public sharing

You can share CoValues publicly by setting the `owner` to a `Group`, and granting
access to "everyone".

<CodeGroup>
  ```ts
  const group = Group.create();
  group.addMember("everyone", "writer"); // *highlight*
  ```
</CodeGroup>

This is done in the [chat example](https://github.com/garden-co/jazz/tree/main/examples/chat) where anyone can join the chat, and send messages.

You can also [add members by Account ID](/docs/groups/intro#adding-group-members-by-id).

## Invites

You can grant users access to a CoValue by sending them an invite link.

This is used in the [pet example](https://github.com/garden-co/jazz/tree/main/examples/pets)
and the [todo example](https://github.com/garden-co/jazz/tree/main/examples/todo).

<ContentByFramework  framework="react">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-react";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="react-native">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-react-native";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="react-native-expo">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-expo";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="vue">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-vue";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="svelte">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-browser";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

It generates a URL that looks like `.../invite/[CoValue ID]/[inviteSecret]`

In your app, you need to handle this route, and let the user accept the invitation,
as done [here](https://github.com/garden-co/jazz/tree/main/examples/pets/src/2_main.tsx).

<CodeGroup>
```ts
useAcceptInvite({
  invitedObjectSchema: PetPost,
  onAccept: (petPostID) => navigate("/pet/" + petPostID),
});
```
</CodeGroup>


### Requesting Invites

To allow a non-group member to request an invitation to a group you can use the `writeOnly` role.

In your app, handle creating the queue of requests

<CodeGroup>
```ts twoslash
import { Group, co, CoList, CoMap} from "jazz-tools";
import {createInviteLink} from jazz-react;

class Project extends CoMap {
  title = co.string;
  account = co.ref(Account);
}

class Request extends CoMap {
  project = co.ref(Project);
}

export class RequestsList extends CoMap.Record(co.ref(Request)) {}

export class RequestsToJoin extends CoMap {
  writeOnlyInvite = co.string;
  requests = co.ref(RequestsList);
}

// ---cut-before---

function createRequestsToJoin() {
  const everyoneReaderGroup = Group.create()
  everyoneReaderGroup.addMember("everyone", "reader")

  const requestsGroup = Group.create()
  const writeOnlyInvite = createInviteLink(requestsGroup, "writeOnly")
  
  return RequestsToJoin.create({ 
    writeOnlyInvite, 
    requests: RequestsList.create({}, requestsGroup)
  }, everyoneReaderGroup)
}
```
</CodeGroup>

Users can then send a request to join a specific organization. 
Example is coming soon!

<CodeGroup>
```ts twoslash
import { co, CoList, CoMap, ID } from "jazz-tools";
import {createInviteLink, consumeInviteLink, Account } from jazz-react;

class Project extends CoMap {
  title = co.string;
}

class Request extends CoMap {
  project = co.ref(Project);
  account = co.ref(Account);
}

export class RequestsList extends CoMap.Record(co.ref(Request)) {}

export class RequestsToJoin extends CoMap {
  writeOnlyInvite = co.string;
  requests = co.ref(RequestsList);
}

// ---cut-before---

async function requestToJoin(projectId: ID<Project>) {
   const requestsToJoin = await RequestsToJoin.load(projectId)

   const result = await consumeInviteLink({ 
    inviteURL: requestsToJoin.writeOnlyInvite, 
    invitedObjectSchema: RequestsList 
   })
   
   if (!result) throw new Error("Failed to accept the requests writeOnly invitation")

   const requests = await RequestsList(result.valueID)

   requests.push(RequestToJoin.create({ account: Account.getMe() }, requests._owner));
}
```
</CodeGroup>
